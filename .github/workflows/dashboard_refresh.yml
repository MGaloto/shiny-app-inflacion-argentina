name: Update Data and Deploy

on: 
  push:
    branches: [main]
  schedule:  
    - cron: '0 19,21 1,12,17,25 * *' # el dia 1,10,17 y 25 del mes a las 18 hs argentina
    # cada doce horas '0 */12 * * *'
    # cada 10 min '*/10 * * * *'
    # '0 0 * * *' # Ejecuta el cron una vez al d√≠a a las 00:00 UTC

jobs:
  refresh-the-dashboard:
    runs-on: ubuntu-latest  # version mas reciente de ubuntu
    permissions:
      contents: write
      actions: write
      pages: write

    container: 
      image: mgaloto/flexdashiny_03

    steps:
    - name: checkout_repo
      uses: actions/checkout@v3
      with: 
        ref: 'main'

    - name: Render Update
      run: bash ./bash/render_dashboard.sh "MGaloto" "maxigaloto@hotmail.com"

    - name: Deploy app
      run: Rscript deploy.R
      env:
        SHINY_ACC_NAME: ${{ secrets.SHINY_ACC_NAME }}
        TOKEN: ${{ secrets.TOKEN }}
        SECRET: ${{ secrets.SECRET }}
